name: Practica_docker #Nombre del workflow

on:
 workflow_dispatch: #Activa el workflow solo cuando nosotros le indiquemos manualmente
  inputs: #Nos pide el nombre de la imagen
   image_name:
    description: nombre de la imagen
    required: true
jobs:
 practica_docker:
  runs-on: ubuntu-latest #indicamos en que SO correra
  steps: #definimos los pisos que tiene
   - name: Login Dockerhub #Nombre del paso
     uses: docker/login-action@v1 #indicamos que usaremos el action de dockerhub para iniciar sesion
     with:
      username: ${{ secrets.DOCKER_USER }} #Iniciaremos sesion en dockerhub con el secret de usuario para dockerhub 
      password: ${{ secrets.DOCKER_HUB_TOKEN }} #Iniciaremos sesion en dockerhub con el secret de password para docjerhub

   - name: Descargar imagen
     run: docker pull ramsus/test1 #Hacemos un pull de la imagen de Dockerhub
   
   - name: Cambiar nombre de la imagen
     run: docker tag ramsus/${{ github.event.inputs.image_name }} registry.gitlab.com/practica-docker/practica-docker/${{ github.event.inputs.image_name }}
     
   - uses: actions/checkout@v2 #indicamos que usaremos el action de dockerhub para iniciar sesion
   - name: push image
     run: |
        docker build . --file Dockerfile --tag docker.io/${{ secrets.DOCKER_USER }}/${{ secrets.DOCKER_HUB_REPOSITORY }}:$GITHUB_SHA
        docker push docker.io/${{ secrets.DOCKER_USER }}/${{ secrets.DOCKER_HUB_REPOSITORY }}:$GITHUB_SHA
     
